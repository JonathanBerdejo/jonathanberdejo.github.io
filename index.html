<script>
document.addEventListener('DOMContentLoaded', () => {
  // A√±o en el footer
  const y = document.getElementById('year');
  if (y) y.textContent = new Date().getFullYear();

  // Pausar l√≠neas al hacer scroll
  window.addEventListener('scroll', () => {
    document.body.classList.toggle('scrolled', window.scrollY > innerHeight * 0.7);
  }, { passive:true });

  // === ‚≠ê Estrellas ===
  (function stars(){
    const wrap = document.querySelector('.stars');
    if (!wrap) return;
    const N = matchMedia('(max-width:900px)').matches ? 80 : 160;
    const frag = document.createDocumentFragment();
    for (let i=0;i<N;i++){
      const s = document.createElement('i');
      s.className = 'star';
      s.style.left = (Math.random()*100) + '%';
      s.style.top  = (Math.random()*100) + '%';
      s.style.setProperty('--sc', (0.6 + Math.random()*1.6).toFixed(2));
      s.style.setProperty('--tw', (2.2 + Math.random()*4.2).toFixed(2) + 's');
      s.style.setProperty('--td', (Math.random()*5).toFixed(2) + 's');
      frag.appendChild(s);
    }
    wrap.appendChild(frag);
  })();

  // === üí° HUD spotlight ===
  (function hudSpotlight(){
    const hud = document.querySelector('.hud-nav');
    if (!hud) return;
    hud.addEventListener('mousemove', (e) => {
      const r = hud.getBoundingClientRect();
      hud.style.setProperty('--mx', (e.clientX - r.left) + 'px');
      hud.style.setProperty('--my', (e.clientY - r.top) + 'px');
    });
    hud.addEventListener('mouseleave', () => {
      hud.style.removeProperty('--mx');
      hud.style.removeProperty('--my');
    });
  })();

  // === üîπ Indicador de secci√≥n activa ===
  (function hudActive(){
    const links = [...document.querySelectorAll('.hud-nav a[data-link]')];
    const ind   = document.querySelector('.hud-indicator');
    if (!links.length || !ind) return;

    const secs = links
      .map(a => document.querySelector(a.getAttribute('href')))
      .filter(Boolean);

    function setActive(hash){
      links.forEach(a => a.classList.toggle('active', a.getAttribute('href') === hash));
      const active = links.find(a => a.classList.contains('active')) || links[0];
      const r = active.getBoundingClientRect();
      const navR = active.parentElement.getBoundingClientRect();
      ind.style.setProperty('--indX', (r.left - navR.left + 8) + 'px');
      ind.style.setProperty('--indW', (r.width - 16) + 'px');
    }

    function onScroll(){
      let cur = '#home';
      for (const sec of secs){
        const rect = sec.getBoundingClientRect();
        if (rect.top <= innerHeight*0.38 && rect.bottom >= innerHeight*0.38){
          cur = '#' + sec.id; break;
        }
      }
      setActive(cur);
    }

    window.addEventListener('scroll', onScroll, { passive:true });
    window.addEventListener('resize', onScroll);
    links.forEach(a => a.addEventListener('click', () => setActive(a.getAttribute('href'))));
    onScroll();
  })();

  // === ‚òÑÔ∏è Cometas ===
  (function comets(){
    const layer = document.querySelector('.comets');
    if (!layer) return;

    let active = 0;
    let maxActive = matchMedia('(max-width:900px)').matches ? 2 : 5;

    function spawn(delayMs = 0){
      if (active >= maxActive) return;
      const el = document.createElement('i');
      el.className = 'comet';

      const startX = 8 + Math.random()*84;                    // 8‚Äì92 vw
      const driftX = (-10 - Math.random()*22).toFixed(2) + 'vw'; // -10 a -32 vw
      const angle  = (12 + Math.random()*12).toFixed(2) + 'deg';
      const dur    = (2.4 + Math.random()*2.4).toFixed(2) + 's';
      const size   = (7 + Math.random()*10).toFixed(1) + 'px';
      const tail   = (170 + Math.random()*180).toFixed(0) + 'px';
      const hue    = (12 + Math.random()*18).toFixed(0);
      const lum    = (50 + Math.random()*10).toFixed(0) + '%';

      el.style.setProperty('--startX', startX.toFixed(2));
      el.style.setProperty('--driftX', driftX);
      el.style.setProperty('--angle',  angle);
      el.style.setProperty('--dur',    dur);
      el.style.setProperty('--size',   size);
      el.style.setProperty('--tail',   tail);
      el.style.setProperty('--hue',    hue);
      el.style.setProperty('--lum',    lum);

      // 25% m√°s grandes/brillantes
      if (Math.random() < 0.25){
        el.style.setProperty('--size', (parseFloat(size)*1.4) + 'px');
        el.style.setProperty('--tail', (parseFloat(tail)*1.5) + 'px');
      }

      if (delayMs) el.style.animationDelay = delayMs + 'ms';

      layer.appendChild(el);
      active++;
      el.addEventListener('animationend', () => { el.remove(); active--; }, { once:true });
    }

    function loop(){
      setTimeout(() => { spawn(); loop(); }, 2000 + Math.random()*2000);
    }
    function bursts(){
      setInterval(() => {
        const n = 3 + Math.floor(Math.random()*4); // 3‚Äì6
        for (let i=0;i<n;i++) spawn(i*200);
      }, 18000);
    }

    spawn();
    loop();
    bursts();
  })();
});
</script>
